<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üì∏ Photos Gallery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: #f8f9fa; }
    header {
      background: linear-gradient(135deg, #4e73df, #1cc88a);
      color: white;
      border-radius: 25px;
      padding: 20px;
      margin: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    header h2 { font-size: 1.5rem; margin-bottom: 10px; }
    .info-box {
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 20px auto;
      max-width: 900px;
      text-align: center;
    }
    .photo-card { border: none; background: transparent; text-align: center; }
    .photo-card img {
      width: 100%;
      height: auto;
      border-radius: 12px;
      display: block;
      margin: 0 auto;
    }
    .photo-title {
      font-size: 0.9rem;
      margin-top: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #loadMoreBtn { display: none; }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <h2 class="m-0">üì∏ 2023 PHOTOS</h2>
    <a href="HOME.HTML" class="btn btn-light btn-sm">Home</a>
  </header>

  <!-- Info Box -->
  <div class="info-box">
    <h4>Your Lovely Photos ‚ù§Ô∏è</h4>
    <p>Below are the synced photos directly from Google Drive. You can view or download them anytime.</p>
  </div>

  <!-- Gallery -->
  <div class="container">
    <div id="status" class="mb-3 text-center text-muted"></div>
    <div id="gallery" class="row g-3"></div>
    <div class="text-center mt-3">
      <button id="loadMoreBtn" class="btn btn-success">Load More</button>
    </div>
  </div>

  <script>
    const API_KEY = "AIzaSyACL1BBtMdua_vQKbsGr2jUDeXphnDTFkI";
    const FOLDER_ID = "1zF3ZfWBc-YrnZ-tJQqQDSq0lSIEobchg";

    const statusEl = document.getElementById("status");
    const gallery = document.getElementById("gallery");
    const loadMoreBtn = document.getElementById("loadMoreBtn");

    let nextPageToken = null;
    const PAGE_SIZE = 20;

    function updateStatus(msg) {
      statusEl.textContent = msg;
    }

    async function listImageFilesInFolder(folderId, pageToken = null) {
      const q = `'${folderId}' in parents and trashed = false and mimeType contains 'image/'`;
      let url = `https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(q)}&pageSize=${PAGE_SIZE}&fields=nextPageToken,files(id,name,mimeType,webViewLink)&key=${API_KEY}`;
      if (pageToken) url += `&pageToken=${pageToken}`;
      const r = await fetch(url);
      if (!r.ok) throw new Error("Drive API request failed: " + r.status);
      const data = await r.json();
      nextPageToken = data.nextPageToken || null;
      return data.files;
    }

    function renderFiles(files) {
      files.forEach(f => {
        const col = document.createElement("div");
        col.className = "col-12 col-sm-6 col-md-4 col-lg-3";

        const card = document.createElement("div");
        card.className = "photo-card";

        // ‚úÖ Clear Full Image (Googleusercontent link)
        const img = document.createElement("img");
        img.src = `https://lh3.googleusercontent.com/d/${f.id}=w1000`;
        img.alt = f.name;

        const title = document.createElement("div");
        title.className = "photo-title";
        title.textContent = f.name;

        const btnGroup = document.createElement("div");
        btnGroup.className = "d-flex justify-content-center gap-2 mt-2";

        const dlBtn = document.createElement("a");
        dlBtn.className = "btn btn-sm btn-primary";
        dlBtn.textContent = "Download";
        dlBtn.href = `https://drive.google.com/uc?export=download&id=${f.id}`;
        dlBtn.download = f.name;

        const viewBtn = document.createElement("a");
        viewBtn.className = "btn btn-sm btn-outline-secondary";
        viewBtn.textContent = "Open";
        viewBtn.href = f.webViewLink || `https://drive.google.com/file/d/${f.id}/view`;
        viewBtn.target = "_blank";

        btnGroup.appendChild(dlBtn);
        btnGroup.appendChild(viewBtn);

        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(btnGroup);

        col.appendChild(card);
        gallery.appendChild(col);
      });
    }

    async function loadPhotos() {
      try {
        updateStatus("Loading photos...");
        const files = await listImageFilesInFolder(FOLDER_ID, nextPageToken);
        if (!files || files.length === 0) {
          updateStatus("No more images found.");
          loadMoreBtn.style.display = "none";
          return;
        }
        updateStatus("");
        renderFiles(files);
        if (nextPageToken) {
          loadMoreBtn.style.display = "inline-block";
        } else {
          loadMoreBtn.style.display = "none";
        }
      } catch (e) {
        console.error(e);
        updateStatus("‚ùå Error: Check API key, folder ID, and make sure folder is Public.");
      }
    }

    window.onload = () => {
      loadPhotos();
      loadMoreBtn.addEventListener("click", loadPhotos);
    };
  </script>
</body>
</html>
